
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>[da]nilo.dev - Primeiros passos com Visual Studio Code e .Net Core</title>
        <meta name="description" content="Blog Posts" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="[da]nilo.dev" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="[da]nilo.dev" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="[da]nilo.dev" />
        <meta name="msapplication-tooltip" content="[da]nilo.dev" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="[da]nilo.dev - Primeiros passos com Visual Studio Code e .Net Core" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://nilo.dev/post/primeiros-passos-com-vscode-dotnetcore" />
        <!-- TODO: More social graph meta tags -->

        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">[da]nilo.dev</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/post">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About me</a></li>
        <li><a href="/podcasts">Podcasts</a></li>
        <li><a href="/txt">TXT</a></li>
        <li><a href="/now">now</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header" style="background-image: url(&quot;/images/bg/monitors.jpg&quot;)">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Primeiros passos com Visual Studio Code e .Net Core</h1>
    <div class="meta">        
Published on Friday, May 8, 2020 - <a href="https://translate.google.com/translate?sl=en&tl=pt&u=http://nilo.dev/post/primeiros-passos-com-vscode-dotnetcore">Disponível em Português 🇧🇷</a>"<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/dotnetcore" class="btn btn-default btn-xs">#dotnetcore</a>
                    <a role="button" href="/tags/vscode" class="btn btn-default btn-xs">#vscode</a>
        </div>
</div>

                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-8">
                                        

<p>Já a algum tempo eu queria estudar .Net Core e venho postergando. Confesso que a primeira experiência (a cerca de dois anos) não foi lá das melhores.</p>
<h1 id="first-things-first">First things first</h1>
<p>Antes de começar, precisamos das ferramentas que são a <a href="https://pt.wikipedia.org/wiki/Ambiente_de_desenvolvimento_integrado">IDE</a> <strong>Visual Studio Code</strong> e o Framework <strong>.Net Core</strong> (atualmente na versão 3.1).</p>
<p>A escolha do <em>Visual Studio Code</em> para uso com .Net Core foi um pouco dificil... Hoje, praticamente qualquer curso/livro que você encontra sobre o framework, utiliza o Visual Studio Community, que realmente tem seus prós. O Visual Studio Community tem à distância de um click os <a href="https://en.wikipedia.org/wiki/Scaffold_(programming)">scaffoldings</a> que no VSCode vai lhe custar escrever os métodos manualmente ou lembrar uma commandline como <code>dotnet aspnet-codegenerator &lt;model&gt; &lt;namespace&gt; &lt;etc&gt;</code>. Mas como tudo na vida, melhor ou pior, isso depende do ponto de vista e, escrever as classes manualmente (ou quase) vai lhe fazer entender melhor a estrutura do framework e depender menos das coisas criadas automáticamente.</p>
<p>Deixando de lado que algumas tarefas &quot;podem&quot; ser ligeiramente mais trabalhosas, o VSCode é uma IDE extremamente mais leve que sua parente, o que permite ter seu ambiente de desenvolvimento funcionando em praticamente apenas um minuto. A comunidade de desenvolvimento (normalmente mais focada em front-end) vem elogiando bastante a ferramenta e eu acho que vale dar o braço a torcer também para o backend.</p>
<p><strong>Então, mãos a massa!</strong></p>
<p>Precisamos do VSCode e do .Net Core instalados para começcar. Você pode optar por baixar as ferramentas dos respectivos sites ou poupar algum tempo e instalar tudo via commandline:</p>
<pre><code class="language-powershell">Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
choco install vscode -y
choco install dotnetcore -y
</code></pre>
<h1 id="tipos-de-projeto">Tipos de projeto</h1>
<p>Antes de começar o desenvolvimento, dei uma boa lida sobre os tipos de projeto disponíveis utilizando .Net Core. No final das contas, o mesmo projeto com algumas modificações pode rodar em conjunto mvc, razor e uma api, então porque se preocupar com o tipo de projeto? Bom, por alguns motivos:</p>
<ul>
<li>Transformar um projeto iniciado como webapi em razor vai lhe custar algum tempo criando código que vem por padrão na criação do projeto;</li>
<li>Se sua especialidade é backend e não front (o que é o meu caso), vem bem a calhar ter um layout padrão pronto;</li>
<li>Se você pretende criar uma aplicação modular, criar no mesmo projeto (não na mesma <a href="https://docs.microsoft.com/en-us/visualstudio/extensibility/internals/solution-dot-sln-file">solução</a>) a API e a parte Web pode não ser uma boa prática;</li>
</ul>
<p>Dito isso, neste post vamos falar sobre 3 tipos de projeto: mvc, webapi e razor. Caso queira consultar, a lista de tipos de projeto completa está disponível <a href="https://docs.microsoft.com/pt-br/dotnet/core/tools/dotnet-new">neste link</a> e também através da commandline <code>dotnet new --help</code>.</p>
<h2 id="mvc-razor-e-api-principais-diferencas">MVC, Razor e API - Principais diferenças</h2>
<p>Em suma, páginas Razor lembram muito mais o formato Windows Forms que páginas MVC. Páginas MVC te forçam a utilizar o padrão da arquitetura, o que por algumas vezes pode trazer uma complexidade desnecessária para um projeto, enquanto páginas Razor possuem estrutura mais simples. Ambos, Razor e MVC tem suas vantagens e desvantagem e a decisão vai depender do tipo/tamanho/complexidade do projeto que você quer desenvolver. Se tiver tempo disponível, estude sobre as duas.</p>
<p>Já sobre WebApi, este tipo de projeto utiliza os controllers do MVC - apenas descartando a utilização de models e views. É um abordagem simples, e utiliza o <a href="https://docs.microsoft.com/pt-br/aspnet/core/fundamentals/routing">modelo de roteamento e verbos</a> para direcionar as requisições. E aproveitando, páginas Razor utilizam a <a href="https://www.learnrazorpages.com/razor-pages/routing">diretiva <strong>&#64;page</strong></a> para tratar o roteamento.</p>
<p>Artigos sobre o assunto:</p>
<ul>
<li><a href="https://hackernoon.com/asp-net-core-razor-pages-vs-mvc-which-will-create-better-web-apps-in-2018-bd137ae0acaa">ASP.NET Core Razor Pages Vs MVC: Which Will Create Better Web Apps in 2018?</a></li>
<li><a href="https://andrewlock.net/comparing-startup-between-the-asp-net-core-3-templates/">Comparing Startup.cs between the ASP.NET Core 3.0 templates</a></li>
<li><a href="https://www.dotnettricks.com/learn/webapi/difference-between-aspnet-mvc-and-aspnet-web-api">Difference between ASP.NET MVC and ASP.NET Web API</a></li>
</ul>
<h1 id="criando-uma-aplicacao-razor">Criando uma aplicação Razor</h1>
<p>Eu tento normalmente evitar o mouse enquanto programo, então vamos tentar centralizar todo o trabalho no VSCode utilizando commandlines.</p>
<ul>
<li>Com o VSCode aberto, acesse o terminal com o comando <code>CTRL + '</code></li>
<li>No terminal, caso ainda não possua, crie uma pasta para armazenar seus projetos com o comando <code>mkdir ~/Projects</code></li>
<li>Navegue até a pasta onde você armazena de projetos com o comando <code>cd ~/Projects</code></li>
<li>Crie um novo projeto Razor com o comando <code>dotnet new webapp -o RazorProject</code></li>
<li>Carregue a pasta do projeto chamada &quot;RazorProject&quot; com o comando <code>code -r RazorProject</code> ou <code>CRTL + K, CRTL + O</code> (ignore/feche o pop-up de alerta <code>Required assets to build and debug are missing from 'RazorProject'. Add them?</code> por hora)</li>
<li>Abra o terminal novamente (<code>CTRL + '</code>) e execute o projeto com o comando <code>dotnet run</code></li>
<li>Leia a mensagem do console, se algo como <code>Now listening on: https://localhost:5001</code> apareceu, teste o acesso a url https://localhost:5001 no seu navegador, e voilà! Sua aplicação está rodando!</li>
</ul>
<p><img src="/images/posts/2020/razor-page.png" class="img-fluid" alt="default-razor-page" /></p>
<p>Bom, quase... Talvez o <a href="https://code.visualstudio.com/docs/editor/intellisense">intelisense</a> ainda não esteja funcionando e nem o debugging, mas já vamos dar uma olhada nesses caveats.</p>
<blockquote class="blockquote">
<p>Em ambiente Windows é normal utilizar um backslash <code>&quot;\&quot;</code> enquanto que Linux um slash <code>&quot;/&quot;</code> para o caminho de pastas, mas o exemplo acima vai funcionar da mesma forma em Windows se o seu terminal for um console de Powershell - que é o padrão no VSCode.</p>
</blockquote>
<h2 id="debugging">Debugging</h2>
<p>Quando você carregou o projeto no VSCode, provavelmente um popup com o alerta <code>⚠ Required assets to build and debug are missing from 'RazorProject'. Add them?</code> apareceu. Isso significa que a pasta <code>.vscode</code> com as configurações de build não existem, mas a pasta é criada automaticamente, quando você executa um <code>F5</code> ou <code>Run &gt; Start Debugging</code> e seleciona na lista a opção <code>.Net Core</code>. Teclando <code>F5</code> novamente vai executar a aplicação e você pode tentar debugar a aplicação.</p>
<blockquote class="blockquote">
<p>É possível que o <a href="https://github.com/OmniSharp/omnisharp-vscode">Omnisharp</a> ou o ms-dotnettools.csharp, extensões utilizadas para desenvolvimento com .Net Core, falhem em carregar alguma DLL e o path <code>program</code> do projeto, no arquivo <code>/.vscode/launch.json</code> fique mais ou menos assim: <code>${workspaceFolder}/bin/Debug/insert-target-framework-here/insert-project-name-here.dll</code>. Se você tiver esse problema, substitua no caminho <code>insert-target-framework-here</code> por <code>netcoreapp3.1</code> e <code>insert-project-name-here</code> por <code>RazorProject</code>.</p>
</blockquote>
<blockquote class="blockquote">
<p>Se algum erro aparecer relacionado como o MSBuild apontando alguma DLL faltando e você tem outra versão do Visual Studio instalada, veja se na mensagem de erro o path do msbuild aponta para o executável do Visual Studio Community/Professional. É possível corrigir isso de <a href="https://github.com/OmniSharp/omnisharp-roslyn/issues/1094">algumas formas</a> e eu não lembro como corrigi o meu... Mas nada q alguns minutos no Google não resolvam.</p>
</blockquote>
<p>Se você está comigo até aqui e quer deixar o mouse de lado enquanto programa, siga os seguintes passos:</p>
<ul>
<li>No VSCode, tecle <code>CTRL SHIFT + E</code>, navegue utilizando os direcionais <code>⬆</code>, <code>⬇</code> e <code>➡</code> (para expandir uma pasta), selecione o arquivo /Pages/Index.cshtml.cs e tecle <code>Enter</code>;</li>
<li>Navegue para a linha com o código <code>public void OnGet()</code>, você pode utilizar o comando <code>CTRL + G</code> e digitar o número da linha se quiser;</li>
<li>Crie um breakpoint, teclando <code>F9</code>, feito isso volte ao browser com a página https://localhost:5001 e recarregue a mesma;</li>
<li>Volte para o VSCode e veja que a IDE está aguardando a continuação, tecle <code>F5</code> para prosseguir</li>
</ul>
<p>A princípio, parece trabalho demais lembrar de todos esses comandos para programar e, de fato você pode fazer tudo isso clicando. E você também pode utilizar um alicate para martelar um prego ao invés de um martelo... Essa não é uma verdade universal apesar da brincadeira mas, com o tempo, deixar o mouse de lado te recompensa com uma melhora na produtividade e até com a ergonomia, já que você se movimenta menos não tendo que alcançar o mouse para executar algumas tarefas.</p>
<p>Debugar não tem nenhum segredo, mas lembrar as teclas de debugging vão melhorar um pouquinho a sua produtividade também. Tente utilizar conforme a necessidade, lembrar todos esses comandos de uma vez só pode fazer você criar aversão por utilizá-los e, se gostar muito quem sabe você não migra para o <a href="https://www.vim.org/">Vim</a>...</p>
<table class="table">
<thead>
<tr>
<th>Tecla</th>
<th>Ação</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>F5</code></td>
<td><code>Continue / Pause</code></td>
<td>Executa o projeto em Debugging Mode</td>
</tr>
<tr>
<td><code>CTRL + F5</code></td>
<td><code>Run</code></td>
<td>Executa o projeto sem Debugging Mode</td>
</tr>
<tr>
<td><code>CTRL SHIFT + F5</code></td>
<td><code>Restart</code></td>
<td>Reinicia a execução do projeto</td>
</tr>
<tr>
<td><code>SHIFT + F5</code></td>
<td><code>Stop</code></td>
<td>Para a execução do projeto</td>
</tr>
<tr>
<td><code>F10</code></td>
<td><code>Step Over</code></td>
<td>Executa a próxima linha de código a partir do ponto de parada atual.</td>
</tr>
<tr>
<td><code>F11</code></td>
<td><code>Step Into</code></td>
<td>Executa a próxima linha de código a partir do ponto de parada atual. Se for uma função/método presente no seu código, entra na função e começa a debugar o código da função</td>
</tr>
<tr>
<td><code>SHIFT + F11</code></td>
<td><code>Step Out</code></td>
<td>Executa a função atual até o fim, saí da função atual e continua o debugging na próxima linha após termino de execução da função</td>
</tr>
</tbody>
</table>
<p>Bom, já temos o básico para começar e, inspirado num post do <a href="https://medium.com/&#64;renato.groffe/consumo-de-apis-em-net-core-utilizando-apis-rest-da-nasa-7dd6bd407329">Renato Groffe</a>, vamos fazer nossa aplicação consultar a API &quot;Astronomy Picture of the Day&quot; da Nasa, com algumas variações do que ele fez lá para explorarmos o framework, então já <a href="https://api.nasa.gov/">faça seu cadastro</a> e pegue sua <strong>API Key</strong>.</p>
<h2 id="arquivos-de-configuracao-appsettings.json">Arquivos de configuração - appsettings.json</h2>
<p>Para evitar ter os dados de configuração <a href="https://en.wikipedia.org/wiki/Hard_coding">hardcoded</a> na aplicação, o que é uma péssima prática, vamos armazená-los num arquivo de configuração, que no nosso caso é o appsettings.json, substituto do velho <code>Web.Config</code> e deve estar na raiz do seu projeto após executar o comando <code>dotnet new webapp</code>.</p>
<blockquote class="blockquote">
<p>Aqui eu tenho uma crítica. O .Net Core utiliza o padrão de design de software baseado em Dependecy Injection, que permite ter um objeto strong typed como resultado do carregamento das configurações, o que realmente é ótimo, mas em contra partida trouxe uma complexidade desnecessária para recuperar dados de configuração. Talvez essa seja uma tentativa de aplicar o <a href="https://12factor.net/pt_br/config">Twelve Factors</a> a risca e forçar o desenvolvedor a utilizar variáveis de ambiente para determinado tipo de dado, mas isso não explica outros problemas com a complexidade desnecessária do framework, como a classe <strong>HttpClient</strong> só fazer chamadas async, mesmo quando você não precisa usar async. Poxa, extrair dados sem referenciar diretamente o arquivo de configuração poderia ter sido implementado, dado que antes poderiamos fazer algo do tipo <code>string userName = System.Configuration.ConfigurationManager.AppSettings[&quot;UserName&quot;];</code>... Vida que segue.</p>
</blockquote>
<p>Primeiro, vamos preencher o appsettings.json com os dados para utilizar o endpoint da Nasa. Seu arquivo deve parecer da seguinte forma:</p>
<pre><code class="language-json">{
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft&quot;: &quot;Warning&quot;,
      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
    }
  },
  &quot;AllowedHosts&quot;: &quot;*&quot;,
  &quot;NasaConfiguration&quot;:{
    &quot;Endpoint&quot;: &quot;https://api.nasa.gov/planetary/apod&quot;,
    &quot;ApiKey&quot;: &quot;&lt;your_api_key&gt;&quot;
  }
}
</code></pre>
<blockquote class="blockquote">
<p>Não esqueça de substituir <code>&lt;your_api_key&gt;</code> pela sua chave de API!</p>
</blockquote>
<p>Com isso, precisamos extrair os dados da API do arquivo <strong>appsettings.json</strong> e fazer uma chamada HTTP para o endpoint, o que pode ser feito de algumas formas, dependendo do refinamento que você quer para seu código.</p>
<h3 id="via-dependency-injection-ou-di">Via Dependency Injection (ou DI)</h3>
<p>Você pode recuperar os dados passando um parâmetro <strong>IConfiguration config</strong> no construtor <em>IndexModel</em> da sua página <strong>Index.cshtml.cs</strong>, o que vai produzir uma variável de saída <code>&quot;https://api.nasa.gov/planetary/apod&quot;</code>. A classe deve ficar mais ou menos assim (este é só o código dentro de public class <code>IndexModel : PageModel</code>):</p>
<pre><code class="language-csharp">private readonly ILogger&lt;IndexModel&gt; _logger;
private readonly IConfiguration _config;
public IndexModel(ILogger&lt;IndexModel&gt; logger, IConfiguration config)
{
    _config = config;
    _logger = logger;
}

public void OnGet()
{
    var endPoint = _config.GetSection(&quot;NasaConfiguration:EndPoint&quot;);
}
</code></pre>
<p>O código acima faz com que o resultado seja apenas uma saída de texto criada a partir do conteúdo preenchido no arquivo de configuração.</p>
<p>Já para que possamos utilizar melhor a capacidade do IConfiguration, é possível extrair os dados baseado num modelo com atributos pré definidos. Esta é a abordagem que vou utilizar, pois apesar de ambas terem o mesmo efeito como produto final, deixar os atributos visíveis ao recuperar dados de configuração evita que precisemos abrir o arquivo <strong>appsettings.json</strong> para confirmar o nome das variaveis quando precisarmos utiliza-las.</p>
<p>Para criar o arquivo de modelo <strong>NasaConfiguration.cs</strong>, basta no terminal (<code>CTRL + '</code>) executar o comando <code>code NasaConfiguration.cs</code>. Aqui, podemos escrever o arquivo do zero nomeando o namespace e a class, ou se você não curte um mínimo já pré-definido num novo arquivo de classe, há a opção de instalar uma extensão como a <code>jchannon.csharpextensions</code>. No meu caso, por hora vou seguir com o setup mais limpo possível.</p>
<pre><code class="language-csharp">//NasaConfiguration.cs
namespace RazorProject {
    public class NasaConfiguration {
        public string Endpoint { get; set; }
        public string ApiKey { get; set; }
    }
}
</code></pre>
<p>E para nosso Index, vamos utilizar o construtor novamente com DI, mas desta vez vamos atribuir os dadosa nossa variável que possui o modelo do arquivo de configuração. Isso pode ser feito tanto com <code>config.GetSection(&quot;NasaConfiguration&quot;).Get&lt;NasaConfiguration&gt;();</code> quanto com <code>config.GetSection(&quot;NasaConfiguration&quot;).Bind(&lt;input_variable&gt;);</code>, sendo que no segundo caso é necessário que a variável utilizada como <em>input_variable</em> seja previamente instânciada. Veremos num exemplo adiante.</p>
<pre><code class="language-csharp">//Index.cshtml.cs
public class IndexModel : PageModel
{
    private readonly NasaConfiguration _nasa;
    private readonly ILogger&lt;IndexModel&gt; _logger;

    public IndexModel(ILogger&lt;IndexModel&gt; logger, IConfiguration config)
    {
        _nasa = config.GetSection(&quot;NasaConfiguration&quot;).Get&lt;NasaConfiguration&gt;();
        _logger = logger;
    }

    public void OnGet()
    {
        string endPoint = _nasa.Endpoint;
        string apiKey = _nasa.ApiKey;
    }
}
</code></pre>
<p>Este modo de uso cobre essencialmente o que precisamos e você pode pular para <a href="#consumindo-a-api-picture-of-the-day">a proxima parte</a> se não tiver interesse nos demais modos de carregar dados do arquivo de configuração.</p>
<h2 id="via-configurationbuilder">Via ConfigurationBuilder</h2>
<p>Com o exemplo anterior, utilizar Dependency Injection não parece tão ruim. O problema fica evidente mesmo quando precisamos usar uma configuração numa classe que passa por algumas funções até chegar no ponto que é feito o Injection. Imagine a seguinte chamada das funções:</p>
<pre><code>IndexModel(IConfiguration config) &gt; 
    Nasa.GetItem(IConfiguration config, &quot;PlanetName&quot;) &gt; 
    NasaCustomQuery(IConfiguration config, $&quot;Select Name, Location from NasaSQL where Name ='{planetName}'&quot;) &gt;
    NasaWebRequest(IConfiguration config, string params)
</code></pre>
<p>Claro que para uma chamada simples como é o da API da Nasa, esse exemplo não requer tanta complexidade, mas vão haver casos onde você vai ter uma complexidade parecida e, trafegar os dados recuperados na primeira função durante 4 chamadas é muita repetição de código desnecessária. Se o dado só precisa ser utilizado na função <em>NasaWebRequest</em> podemos criar uma função auxiliar para carregar uma instância do IConfiguration pode ser a melhor opção:</p>
<pre><code class="language-csharp">// configPath = &quot;NasaConfiguration:Endpoint&quot;
public string RetrieveConfiguration (string configPath){ 
    var configurationBuilder = new ConfigurationBuilder();
    var path = Path.Combine(Directory.GetCurrentDirectory(), &quot;appsettings.json&quot;);
    configurationBuilder.AddJsonFile(path, false);
    var root = configurationBuilder.Build();

    return root.GetSection(configPath).Value;
}
</code></pre>
<p>E utilizando a classe <code>ConfigurationBuilder</code> é possível também carregar as configurações através de um modelo, da mesma forma que no exemplo utilizando <strong>DI</strong>:</p>
<pre><code class="language-csharp">var configurationBuilder = new ConfigurationBuilder();
var path = Path.Combine(Directory.GetCurrentDirectory(), &quot;appsettings.json&quot;);
configurationBuilder.AddJsonFile(path, false);
var config = configurationBuilder.Build();

var nasa = new NasaConfiguration();
config.GetSection(&quot;NasaConfiguration&quot;).Bind(nasa);

string endPoint = _nasa.Endpoint;
string apiKey = _nasa.ApiKey;
</code></pre>
<h2 id="via-ioptions">Via IOptions</h2>
<p>O uso de IOptions demanda configurar o Startup.cs e carregar o objeto utilizando dependency injection no arquivo onde você for utilizar as informações, da mesma forma que o IConfiguration:</p>
<pre><code class="language-csharp">//Startup.cs
public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
    services.Configure&lt;NasaConfiguration&gt;(options =&gt; Configuration.GetSection(&quot;NasaConfiguration&quot;).Bind(options));
}
</code></pre>
<pre><code class="language-csharp">//Index.cshtml.cs
private readonly IOptions&lt;NasaConfiguration&gt; _options;
private readonly ILogger&lt;IndexModel&gt; _logger;

public IndexModel(ILogger&lt;IndexModel&gt; logger, IOptions&lt;NasaConfiguration&gt; options)
{
    _options = options;
    _logger = logger;
}

public void OnGet()
{
    var options = _options.Value;
    string endPoint = options.Endpoint;
    string apiKey = options.ApiKey;
}
</code></pre>
<p>Particularmente, eu acho desnecessário utilizar IOptions que, apesar de possuir algumas diferenças em relação ao IConfiguration (como por exemplo, detectar mudanças no arquivo de configuração e recarregar as mesmas), acaba fazendo o mesmo papel que o IConfiguration.</p>
<p>Ufa! Depois de tudo isso só para explicar os arquivos de configuração, hora de voltar ao projeto.</p>
<h1 id="consumindo-a-api-picture-of-the-day">Consumindo a API Picture of the day</h1>
<p>Como este post já está bem extenso, vamos consumir a API a forma mais simples possível para que possamos ter um resultado da aplicação em funcionamento.</p>
<p>Numa situação normal (o que é o caso da API da Nasa), os dados retornados possuem nomes de atributos bem definidos e não dinâmicos, o que permite criar um modelo da mesma forma que fizemos com nosso arquivo de configuração. Contudo, eu vou abordar aqui uma forma mais dinâmica onde não vamos utilizar um modelo e vamos expor todos os dados retornados da API. Você pode checar abaixo um exemplo de resultado da API ou neste link: <a href="https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY">https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY</a></p>
<pre><code class="language-json">{
  &quot;date&quot;: &quot;yyyy-MM-dd&quot;,
  &quot;explanation&quot;: &quot;&quot;,
  &quot;hdurl&quot;: &quot;https://apod.nasa.gov/apod/image/yyyy/file.jpg&quot;,
  &quot;media_type&quot;: &quot;image&quot;,
  &quot;service_version&quot;: &quot;v1&quot;,
  &quot;title&quot;: &quot;Mystic Mountain Monster being Destroyed&quot;,
  &quot;url&quot;:  &quot;https://apod.nasa.gov/apod/image/yyyy/file.jpg&quot;
}
</code></pre>
<p>Aqui, precisamos de uma lib para tratar o conteúdo em Json retornado pela api. Execute no terminal <code>dotnet add package NewtonSoft.Json</code>. Terminada a importação, configurar a URL para onde precisamos enviar nossas requisições, no arquivo <strong>/Pages/Index.cshtml.cs</strong>, adicionando o seguinte código no método <strong>OnGet()</strong>:</p>
<pre><code class="language-csharp">string endPoint = _nasa.Endpoint;
string apiKey = _nasa.ApiKey;

//uri = &quot;https://api.nasa.gov/planetary/apod?api_key=&lt;your_api_key&gt;&amp;date=2019-08-01&quot;
var uri = new Uri(
    QueryHelpers.AddQueryString(endPoint,
        new Dictionary&lt;string, string&gt;(){
            {&quot;api_key&quot;, apiKey},
            {&quot;date&quot;, DateTime.Now.AddDays(-new Random().Next(365)).ToString(&quot;yyyy-MM-dd&quot;)}
        }
    )
);
</code></pre>
<p>Aqui <code>-new Random().Next(365)).ToString(&quot;yyyy-MM-dd&quot;)</code>, estamos gerando um número negativo, randômico, entre 0 e 365 e subtraíndo este dos dias a contar da data atual e formatando este dado para o padrão aceito pela API, então na nossa página iremos exibir a foto de um dia aleatório de até um ano atrás. Utilizar o método <code>QueryHelpers.AddQueryString</code> é opcional, mas deixa o código mais organizado para trabalhar com parâmetros no .Net.</p>
<blockquote class="blockquote">
<p>Para utilizar o QueryHelpers, é necessário utilizar o namespace <code>Microsoft.AspNetCore.WebUtilities</code>. Para facilitar a importação, quando digitar <code>QueryHelpers</code>, caso uma mensagem de erro <code>O nome &quot;QueryHelpers&quot; não existe no contexto atual [RazorProject]csharp(CS0103)</code> apareça, tecle <code>CTRL  + .</code> e selecione a opção <code>using Microsoft.AspNetCore.WebUtilities;</code>.</p>
</blockquote>
<p>Aqui vale uma dica: Evite copiar código.</p>
<p>Copiando código e colando no seu projeto, a única coisa que você está exercitando é sua habilidade de copiar e colar. Escrever o código, mesmo que exatamente igual ao que você está consultando aqui ou em outro momento no Google/StackOverflow vai exercitar sua memória e, provávelmente na próxima vez que você precisar usar essa informação, não vai ter que consultar externamente. Talvez essa seja a informação mais importante de todo o post.</p>
<p>Após gerar a URL, vamos fazer uma chamada HTTP, utilizando o seguinte código (ainda em <strong>/Pages/Index.cshtml.cs</strong>, no método <strong>OnGet()</strong>:):</p>
<pre><code class="language-csharp">using (var client = new HttpClient()){
    var response = client.GetAsync(uri).Result;
    response.EnsureSuccessStatusCode();
    TempData[&quot;NasaData&quot;] = JsonConvert.DeserializeObject(
        response.Content.ReadAsStringAsync().Result
    );
}
</code></pre>
<p>Da mesma forma que com o <code>QueryHelpers</code>, é preciso uma biblioteca para utilizar o método <code>JsonConvert</code>, mas a essa altura, você já sabe como fazer isso.</p>
<p>Aqui, é importante notar a variável <code>TempData</code>. Essa variável é storage container e seus dados estarão disponíveis mesmo fora de nosso arquivo <strong>/Pages/Index.cshtml.cs</strong>, vamos utilizar essa capacidade mais a seguir. Se quiser saber mais sobre TempData: <a href="https://www.learnrazorpages.com/razor-pages/tempdata">https://www.learnrazorpages.com/razor-pages/tempdata</a></p>
<p>No fim, nosso arquivo <strong>/Pages/Index.cshtml.cs</strong> ficou assim:</p>
<pre><code class="language-csharp">//Pages/Index.cshtml.cs:
using System;
using System.Collections.Generic;
using System.Net.Http;
using Microsoft.AspNetCore.Mvc.RazorPages;
using Microsoft.AspNetCore.WebUtilities;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Newtonsoft.Json;

namespace RazorProject.Pages
{
    public partial class IndexModel : PageModel
    {
        private readonly NasaConfiguration _nasa;
        private readonly ILogger&lt;IndexModel&gt; _logger;
        public IndexModel(ILogger&lt;IndexModel&gt; logger, IConfiguration config)
        {
            _nasa = config.GetSection(&quot;NasaConfiguration&quot;).Get&lt;NasaConfiguration&gt;();
            _logger = logger;
        }

        public void OnGet()
        {
            string endPoint = _nasa.Endpoint;
            string apiKey = _nasa.ApiKey;

            var uri = new Uri(
                QueryHelpers.AddQueryString(endPoint,
                    new Dictionary&lt;string, string&gt;(){
                        {&quot;api_key&quot;, apiKey},
                        {&quot;date&quot;, DateTime.Now.AddDays(-new Random().Next(365)).ToString(&quot;yyyy-MM-dd&quot;)}
                    }
                )
            );

            using (var client = new HttpClient())
            {
                var response = client.GetAsync(uri).Result;
                response.EnsureSuccessStatusCode();
                TempData[&quot;NasaData&quot;] = JsonConvert.DeserializeObject(
                    response.Content.ReadAsStringAsync().Result
                );
            }
        }
    }
}
</code></pre>
<p>Neste momento, caso você execute a aplicação, o request na API já deve funcionar e você pode colocar alguns pontos de parada no código para entender melhor o funcionamento. E se tudo deu certo até aqui, podemos seguir para a ultima parte: Exibir os dados resultados da consulta na API.</p>
<pre><code class="language-csharp">// /Pages/Index.cshtml
&#64;page
&#64;model IndexModel
&#64;{
    ViewData[&quot;Title&quot;] = &quot;Home page&quot;;
    string url = ((dynamic)TempData[&quot;NasaData&quot;])[&quot;url&quot;];
    var date = (DateTime)(((dynamic)TempData[&quot;NasaData&quot;])[&quot;date&quot;]);
}

&lt;div class=&quot;text-center&quot;&gt;
    &lt;h1 class=&quot;display-4&quot;&gt;This was Nasa Picture of the day, of date &#64;date.ToShortDateString()&lt;/h1&gt;
    &#64;foreach (dynamic item in (dynamic)TempData[&quot;NasaData&quot;])
    {
        &lt;p&gt;&lt;b&gt;&#64;item.Name&lt;/b&gt; : &#64;item.Value&lt;/p&gt;   
    }
    &lt;img src=&quot;&#64;url&quot; /&gt;
&lt;/div&gt;
</code></pre>
<p>No exemplo acima, estamos convertendo implicitamente a variavel <code>TempData</code> para <code>dynamic</code> e utilizando os dados retornados pela API. Esta parte é bem auto-explicativa e, repare que além dos atributos <strong>url</strong> e <strong>date</strong>, estamos deixando que todos os atributos coletados sejam exibidos, enquanto percorremos os atributos da variável <code>(dynamic)TempData[&quot;NasaData&quot;]</code>.</p>
<p>Tecle <code>F5</code> e, se tudo funcionou, uma pagina semelhante a abaixo deve ser o resultado do projeto:</p>
<p><img src="/images/posts/2020/apod.png" class="img-fluid" alt="picture-of-the-day" /></p>
<p>Por enquanto é isso, num próximo post devemos falar sobre testes.</p>
<p>Link do projeto no Github: <a href="https://github.com/daniloalsilva/NasaApod">https://github.com/daniloalsilva/NasaApod</a></p>
<h1 id="fontes">Fontes:</h1>
<p><a href="https://weblog.west-wind.com/posts/2017/dec/12/easy-configuration-binding-in-aspnet-core-revisited">https://weblog.west-wind.com/posts/2017/dec/12/easy-configuration-binding-in-aspnet-core-revisited</a>
<a href="https://docs.microsoft.com/pt-br/aspnet/core/tutorials/getting-started-with-swashbuckle?view=aspnetcore-3.1&amp;tabs=visual-studio">https://docs.microsoft.com/pt-br/aspnet/core/tutorials/getting-started-with-swashbuckle?view=aspnetcore-3.1&amp;tabs=visual-studio</a>
<a href="https://softchris.github.io/pages/dotnet-core.html">https://softchris.github.io/pages/dotnet-core.html</a></p>



<div class="tags">
      <a role="button" href="/tags/dotnetcore" class="btn btn-default btn-xs">#dotnetcore</a>
      <a role="button" href="/tags/vscode" class="btn btn-default btn-xs">#vscode</a>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'nilo-dev';
    var disqus_identifier = 'primeiros-passos-com-vscode-dotnetcore';
    var disqus_title = 'Primeiros passos com Visual Studio Code e .Net Core';
    var disqus_url = 'http://nilo.dev/post/primeiros-passos-com-vscode-dotnetcore';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/_sdanilo">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/daniloalsilva">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://www.linkedin.com/in/sdanilo">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Copyright © 2024 by Danilo Silva. All rights reserved. 
                        <br />
                        <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>

                        </p>
                </div>
        </div>
</div>
                </footer> 

                <script src="/assets/js/jquery.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>     
                <script src="/assets/js/highlight.pack.js"></script>   
                <script src="/assets/js/clean-blog.js"></script>
                <script src="/assets/js/d3.v3.min.js"></script>
                <script src="/assets/js/trianglify.min.js"></script>
                <script src="/assets/js/Please-compressed.js"></script>
                <script src="/assets/js/background-check.min.js"></script>

                <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
                <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
                <!--[if lt IE 9]>
                        <script src="/assets/js/html5shiv.js"></script>
                        <script src="/assets/js/respond.min.js"></script>
                <![endif]-->
                
                
                <script>hljs.initHighlightingOnLoad();</script>


                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>
